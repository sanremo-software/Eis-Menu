
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Food & Drinks ‚Äì QR Tischbestellung</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --primary: #d40000;
            --primary-dark: #a00000;
            --bg: #f4f4f4;
            --card-bg: #ffffff;
        }
        * { box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: var(--bg);
            margin: 0;
            padding: 0;
            color: #222;
        }

        /* HEADER MIT LOGO NEUTRAL */
        .header {
            width: 100%;
            background: linear-gradient(135deg, #ffffff, #f4f4f4);
            padding: 15px 0;
            border-bottom: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .header-inner {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 0 10px;
        }
        .header-logo {
            max-width: 100%;
            max-height: 80px;
            height: auto;
            width: auto;
            object-fit: contain;
        }
        .header-title {
            font-size: 22px;
            font-weight: 600;
            color: #333;
            letter-spacing: 0.5px;
            text-align: center;
        }
        @media (max-width: 600px) {
            .header-inner {
                flex-direction: column;
                gap: 10px;
            }
            .header-title {
                font-size: 18px;
            }
        }

        .container {
            padding: 15px;
            max-width: 960px;
            margin: 0 auto 25px auto;
        }
        .section-title {
            font-size: 18px;
            margin-top: 18px;
            margin-bottom: 8px;
            border-left: 4px solid var(--primary);
            padding-left: 8px;
        }
        .card {
            background: var(--card-bg);
            padding: 14px;
            border-radius: 12px;
            margin-bottom: 12px;
            box-shadow: 0 0 10px rgba(0,0,0,0.07);
        }
        label {
            font-size: 14px;
            display: block;
            margin-top: 5px;
            margin-bottom: 3px;
        }
        select, input {
            width: 100%;
            padding: 9px 10px;
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid #ccc;
            background: #fff;
        }
        select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
        }
        .btn {
            background: var(--primary);
            color: #fff;
            padding: 10px;
            display: inline-block;
            text-align: center;
            border-radius: 8px;
            text-decoration: none;
            margin-top: 12px;
            font-size: 16px;
            border: none;
            cursor: pointer;
            width: 100%;
        }
        .btn:hover {
            background: var(--primary-dark);
        }
        .btn:disabled {
            background: #999;
            cursor: not-allowed;
        }
        #warenkorb {
            background: #fff;
            padding: 14px;
            border-radius: 12px;
            margin-top: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.07);
            border: 1px solid #f0f0f0;
        }
        #liste-items div {
            padding: 6px 0;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }
        .line-item {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            align-items: center;
        }
        .item-info {
            flex: 1;
        }
        .btn-remove {
            background: #999;
            border: none;
            color: #fff;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
        }
        .total {
            font-weight: bold;
            font-size: 16px;
            margin-top: 10px;
            text-align: right;
        }
        .small {
            font-size: 12px;
            color: #666;
            margin-top: 3px;
        }

        /* TABS / JANELAS */
        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 8px;
        }
        .tab-btn {
            flex: 1 1 auto;
            padding: 8px;
            font-size: 13px;
            border-radius: 999px;
            border: 1px solid #ddd;
            background: #fff;
            cursor: pointer;
        }
        .tab-btn.active {
            background: var(--primary);
            color: #fff;
            border-color: var(--primary);
        }
        @media (max-width: 600px) {
            .tab-btn {
                font-size: 12px;
                padding: 6px;
            }
        }

        /* Rechtlicher Hinweis */
        .legal-box {
            font-size: 11px;
            color: #777;
            margin: 18px auto 0 auto;
            max-width: 960px;
            text-align: center;
            line-height: 1.5;
            padding: 10px 12px 18px 12px;
        }
    </style>
</head>

<body>

<!-- HEADER MIT LOGO NEUTRAL -->
<header class="header">
    <div class="header-inner">
        <!-- wichtig: Bild-Datei im Projektordner ablegen -->
        <img src="food-drinks-logo.png" alt="Food & Drinks Logo" class="header-logo">
        <div class="header-title">Digitaler QR-Tischservice ‚Äì Internes Bestellsystem</div>
    </div>
</header>

<div class="container">

    <!-- TISCHWAHL -->
    <div class="card">
        <h2 class="section-title">Tisch w√§hlen</h2>
        <label for="tisch">Tischnummer ausw√§hlen:</label>
        <select id="tisch">
            <option value="">Tisch ausw√§hlen‚Ä¶</option>
        </select>
        <div class="small">Verf√ºgbar: Tisch 1 bis 33</div>
    </div>

    <!-- PRODUKTWAHL -->
    <div class="card">
        <h2 class="section-title">Produkt w√§hlen</h2>

        <!-- 5 JANELAS -->
        <div class="tabs">
            <button class="tab-btn active" data-group="portions">Portionen</button>
            <button class="tab-btn" data-group="kids">Kinder</button>
            <button class="tab-btn" data-group="eis">Eisbecher & Spaghetti</button>
            <button class="tab-btn" data-group="food">Snacks & Waffeln</button>
            <button class="tab-btn" data-group="drinks">Getr√§nke</button>
        </div>

        <label for="produkt">Produkt:</label>
        <select id="produkt">
            <!-- Optionen werden per JavaScript gef√ºllt -->
        </select>

        <!-- Sortenwahl nur f√ºr Portionen (optional) -->
        <div id="geschmack-box" style="margin-top:12px; display:none;">
            <label>Sorten (optional, bis zu 3 w√§hlen):</label>
            <select id="geschmack1"></select>
            <select id="geschmack2" style="margin-top:6px;"></select>
            <select id="geschmack3" style="margin-top:6px;"></select>
            <div class="small">
                Wenn keine Sorten gew√§hlt werden, kommt die Portion in unserer Standardmischung.
            </div>
        </div>

        <!-- Sahne-Option (nur bei Eis-Artikeln angezeigt) -->
        <div id="sahne-box" style="margin-top:8px; display:none;">
            <label for="sahne">Sahne:</label>
            <select id="sahne">
                <option value="">Bitte ausw√§hlen (optional)</option>
                <option value="mit Sahne">mit Sahne</option>
                <option value="ohne Sahne">ohne Sahne</option>
            </select>
            <div class="small">
                Wenn nichts gew√§hlt wird, bereiten wir es wie auf der Karte zu.
            </div>
        </div>

        <label for="bemerkung" style="margin-top:8px;">Bemerkung (optional):</label>
        <input id="bemerkung" type="text" placeholder="z.B. ohne Sahne, wenig So√üe ‚Ä¶">

        <button class="btn" onclick="addToCart()">Zum Warenkorb hinzuf√ºgen</button>
    </div>

    <!-- WARENKORB -->
    <div id="warenkorb">
        <h2 class="section-title">üß∫ Warenkorb</h2>
        <div id="liste-items"></div>
        <div class="total" id="gesamt">Gesamt: 0,00 ‚Ç¨</div>

        <button id="btn-whatsapp" class="btn" onclick="sendWhatsApp()" disabled>
            Bestellung per WhatsApp senden üì≤
        </button>

        <button id="btn-print" class="btn" style="margin-top:8px; background:#007b83;" onclick="printOrder()" disabled>
            Bestellung drucken üñ®Ô∏è
        </button>

        <button class="btn" style="margin-top:8px; background:#555;" onclick="resetTable()">
            Tisch l√∂schen / neue G√§ste
        </button>

        <div class="small" style="margin-top:6px;" id="gps-info">
            GPS wird gepr√ºft‚Ä¶ bitte Standort-Freigabe erlauben.
        </div>
    </div>

</div>

<!-- RECHTLICHER HINWEIS -->
<div class="legal-box">
    <strong>Rechtlicher Hinweis:</strong><br>
    Dieses Bestellsystem ist ein internes, nicht fiskalisiertes Software-Tool und ersetzt keine
    Registrierkasse oder steuerrechtlich relevante Aufzeichnung.<br><br>
    Der Betreiber dieses Systems ist allein verantwortlich f√ºr die ordnungsgem√§√üe Nutzung und Einhaltung
    aller gesetzlichen Vorschriften. Alle √ºber dieses System erfassten Bestellungen m√ºssen ‚Äì sofern eine
    Registrierkasse oder TSE-konforme Kasse vorhanden ist ‚Äì gesetzlich korrekt in dieser registriert werden.<br><br>
    Dieses System besitzt keine Verbindung zu einer elektronischen Kasse, erf√ºllt nicht die Anforderungen der
    Kassensicherungsverordnung (KassenSichV), der Technischen Sicherheitseinrichtung (TSE) oder der DSFinV-K
    und darf nicht als Kassensystem verwendet werden.<br><br>
    Die Verantwortung f√ºr die steuerlich korrekte Verbuchung aller Ums√§tze liegt vollst√§ndig beim Anwender
    dieses Systems.
</div>

<script>
const WHATSAPP_NUMMER = "4917672809926";

/* Koordinaten deines Caf√©s (anpassen falls n√∂tig) ‚Äì Bad Berleburg ungef√§hr */
const CAFE_LAT = 51.051;
const CAFE_LNG = 8.392;
const MAX_DIST_KM = 1.5;      // maximaler Abstand, z.B. 1,5 km

let gpsOk = false;

// Produktdaten KOMPLETT
const PRODUKTE = {
    23: { name: "23. Kinder Portion (2 Kugeln)", preis: 3.50, type: "cup3" },
    24: { name: "24. Kleine Portion (3 Kugeln)", preis: 5.00, type: "cup3" },
    25: { name: "25. Normale Portion (4 Kugeln)", preis: 6.50, type: "cup3" },
    26: { name: "26. Gro√üe Portion (6 Kugeln)", preis: 9.50, type: "cup3" },

    30: { name: "30. Amarena Becher", preis: 8.50, type: "normal" },
    31: { name: "31. Erdbeer Becher", preis: 8.50, type: "normal" },
    32: { name: "32. Banana Cup", preis: 9.00, type: "normal" },
    33: { name: "33. Liebes Traum", preis: 13.50, type: "normal" },
    34: { name: "34. Kiwi Becher", preis: 8.50, type: "normal" },
    35: { name: "35. Frucht Becher", preis: 8.50, type: "normal" },
    36: { name: "36. Gro√üer Frucht Becher", preis: 11.90, type: "normal" },
    37: { name: "37. Gro√üer Amarena Becher", preis: 12.50, type: "normal" },
    38: { name: "38. Gro√üer Erdbeer Becher", preis: 12.50, type: "normal" },
    39: { name: "39. Erdbeer-Banane Becher", preis: 10.90, type: "normal" },
    40: { name: "40. Exotischer Becher", preis: 12.00, type: "normal" },
    41: { name: "41. Wald Becher", preis: 10.50, type: "normal" },
    42: { name: "42. Bella Italia", preis: 11.00, type: "normal" },
    43: { name: "43. Mango Becher", preis: 9.00, type: "normal" },
    44: { name: "44. Banana Split", preis: 10.00, type: "normal" },
    45: { name: "45. Sommer Becher", preis: 13.00, type: "normal" },
    46: { name: "46. Coppa Melone", preis: 9.50, type: "normal" },
    47: { name: "47. Heidelbeer Becher", preis: 9.50, type: "normal" },
    48: { name: "48. Himbeer Becher", preis: 9.50, type: "normal" },

    50: { name: "50. Spaghetti Eis", preis: 6.50, type: "normal" },
    51: { name: "51. Spaghetti Eis gro√ü", preis: 9.50, type: "normal" },
    52: { name: "52. Spaghetti Vanille", preis: 7.40, type: "normal" },
    53: { name: "53. Spaghetti Erdbeere", preis: 8.90, type: "normal" },
    54: { name: "54. Spaghetti Kiwi", preis: 8.50, type: "normal" },
    55: { name: "55. Spaghetti Vanille-Schoko", preis: 7.50, type: "normal" },
    56: { name: "56. Spaghetti Carbonara", preis: 9.50, type: "normal" },
    57: { name: "57. Spaghetti Nussknacker", preis: 9.50, type: "normal" },
    58: { name: "58. Spaghetti Amarena", preis: 8.90, type: "normal" },
    59: { name: "59. Spaghetti Waldfr√ºchte", preis: 8.90, type: "normal" },
    60: { name: "60. Spaghetti Melone", preis: 8.90, type: "normal" },
    61: { name: "61. Spaghetti Tutti Frutti", preis: 8.90, type: "normal" },
    62: { name: "62. Lasagne Eis", preis: 8.90, type: "normal" },

    63: { name: "63. Pizza Margherita", preis: 9.00, type: "normal" },
    64: { name: "64. Pizza Grandiosa", preis: 12.00, type: "normal" },

    70: { name: "70. Mixgetr√§nk Spezial", preis: 6.50, type: "normal" },
    71: { name: "71. Joghurrette Becher", preis: 9.50, type: "normal" },
    72: { name: "72. Joghurt Cocktail", preis: 9.50, type: "normal" },
    73: { name: "73. Joghurt Kiwi", preis: 9.00, type: "normal" },
    74: { name: "74. Joghurt Erdbeere", preis: 9.00, type: "normal" },
    75: { name: "75. Joghurt Ananas", preis: 9.00, type: "normal" },
    76: { name: "76. M√ºsli Joghurt Becher", preis: 9.00, type: "normal" },
    77: { name: "77. Joghurt Heidelbeere", preis: 9.00, type: "normal" },
    78: { name: "78. Joghurt Banane", preis: 9.00, type: "normal" },
    79: { name: "79. Joghurt Amarena", preis: 9.00, type: "normal" },
    80: { name: "80. Joghurt Himbeere", preis: 9.00, type: "normal" },

    81: { name: "81. Hei√üe Kirschen", preis: 8.50, type: "normal" },
    82: { name: "82. Hei√üe Himbeeren", preis: 9.00, type: "normal" },
    83: { name: "83. Zimt Becher", preis: 8.50, type: "normal" },
    84: { name: "84. Cup D√§nemark", preis: 8.50, type: "normal" },
    85: { name: "85. Wiener Mokka", preis: 8.50, type: "normal" },

    90: { name: "90. Amaretto Becher", preis: 8.50, type: "normal" },
    91: { name: "91. Schwarzwald Becher", preis: 9.00, type: "normal" },
    92: { name: "92. Malaga Becher", preis: 9.00, type: "normal" },
    93: { name: "93. Mon Ch√©ri Becher", preis: 9.50, type: "normal" },
    94: { name: "94. Raffaello Becher", preis: 9.50, type: "normal" },
    96: { name: "96. Eierlik√∂r Becher", preis: 8.50, type: "normal" },
    98: { name: "98. Nuss Becher", preis: 9.50, type: "normal" },
    99: { name: "99. Rocher Becher", preis: 9.50, type: "normal" },
    100:{ name: "100. Giotto Becher", preis: 9.00, type: "normal" },
    101:{ name: "101. Berg Becher", preis: 10.50, type: "normal" },
    102:{ name: "102. Walnuss Becher", preis: 9.50, type: "normal" },
    103:{ name: "103. Coppa Delizia", preis: 10.90, type: "normal" },

    110:{ name: "110. After Eight Becher", preis: 8.90, type: "normal" },
    111:{ name: "111. Stracciatella Becher", preis: 7.90, type: "normal" },
    112:{ name: "112. Tartufo Nero", preis: 9.50, type: "normal" },
    113:{ name: "113. Tartufo Bianco", preis: 9.50, type: "normal" },
    114:{ name: "114. Hausbecher", preis: 20.00, type: "normal" },
    116:{ name: "116. Krokant Becher", preis: 8.50, type: "normal" },
    117:{ name: "117. Schoko Becher", preis: 8.50, type: "normal" },
    118:{ name: "118. Schoko Becher gro√ü", preis: 12.00, type: "normal" },
    122:{ name: "122. Pistazien Becher", preis: 11.50, type: "normal" },

    130:{ name: "130. Flipper", preis: 5.00, type: "normal" },
    131:{ name: "131. Bellini", preis: 6.00, type: "normal" },
    132:{ name: "132. Mimosa", preis: 6.00, type: "normal" },
    133:{ name: "133. Formula 1", preis: 6.00, type: "normal" },
    134:{ name: "134. Formula 2", preis: 6.00, type: "normal" },

    140:{ name: "140. Eiskaffee", preis: 5.50, type: "normal" },
    141:{ name: "141. Eisschokolade", preis: 5.50, type: "normal" },
    142:{ name: "142. Eis-Cappuccino", preis: 5.50, type: "normal" },

    150:{ name: "150. Milch-Mix 0,3 l", preis: 4.00, type: "normal" },
    151:{ name: "151. Milchshake 0,3 l", preis: 4.60, type: "normal" },
    152:{ name: "152. Riesen Milch-Mix 0,5 l", preis: 5.00, type: "normal" },
    153:{ name: "153. Riesen Milchshake 0,5 l", preis: 5.50, type: "normal" },
    154:{ name: "154. Vulcano", preis: 3.70, type: "normal" },
    155:{ name: "155. Orangensaft (frisch)", preis: 4.50, type: "normal" },
    156:{ name: "156. Kalte Zitrone", preis: 3.50, type: "normal" },

    160:{ name: "Erdbeer Donut", preis: 6.90, type: "normal" },
    161:{ name: "Schoko Donut", preis: 6.90, type: "normal" },
    162:{ name: "Caramel Donut", preis: 6.90, type: "normal" },
    163:{ name: "Pistazien Donut", preis: 7.20, type: "normal" },
    164:{ name: "Kinder Donut", preis: 6.50, type: "normal" },

    200:{ name: "Espresso", preis: 2.00, type: "normal" },
    201:{ name: "Espresso Macchiato", preis: 2.30, type: "normal" },
    202:{ name: "Espresso Corretto", preis: 3.40, type: "normal" },
    203:{ name: "Doppelter Espresso", preis: 3.60, type: "normal" },
    204:{ name: "Doppelter Espresso Macchiato", preis: 3.80, type: "normal" },
    210:{ name: "Kaffee", preis: 2.20, type: "normal" },
    220:{ name: "Milchkaffee", preis: 3.00, type: "normal" },
    221:{ name: "Milchkaffee mit Baileys", preis: 4.00, type: "normal" },
    230:{ name: "Latte Macchiato", preis: 3.60, type: "normal" },
    231:{ name: "Latte Macchiato mit Sirup", preis: 3.20, type: "normal" },
    240:{ name: "Cappuccino", preis: 2.60, type: "normal" },
    241:{ name: "Cappuccino gro√ü", preis: 3.00, type: "normal" },
    244:{ name: "Cappuccino mit Amaretto", preis: 4.00, type: "normal" },
    245:{ name: "Cappuccino mit Eierlik√∂r", preis: 4.00, type: "normal" },
    246:{ name: "Cappuccino mit Baileys", preis: 4.00, type: "normal" },

    300:{ name: "Coca-Cola 0,2 l", preis: 2.70, type: "normal" },
    301:{ name: "Coca-Cola Light 0,2 l", preis: 2.70, type: "normal" },
    302:{ name: "Coca-Cola Zero 0,2 l", preis: 2.70, type: "normal" },
    303:{ name: "Fanta 0,2 l", preis: 2.70, type: "normal" },
    304:{ name: "Mezzo Mix 0,2 l", preis: 2.70, type: "normal" },
    305:{ name: "Sprite 0,2 l", preis: 2.70, type: "normal" },
    306:{ name: "Bitter Lemon 0,2 l", preis: 2.70, type: "normal" },
    307:{ name: "Apfelschorle", preis: 1.90, type: "normal" },
    308:{ name: "Eistee", preis: 1.90, type: "normal" },
    309:{ name: "Wild Berry", preis: 2.20, type: "normal" },
    310:{ name: "Tonic Water", preis: 2.20, type: "normal" },
    311:{ name: "S.Pellegrino 0,25 l", preis: 2.40, type: "normal" },
    312:{ name: "S.Pellegrino 0,75 l", preis: 5.90, type: "normal" },

    350:{ name: "Krombacher Pils 0,33 l", preis: 2.80, type: "normal" },
    351:{ name: "Krombacher Radler 0,33 l", preis: 2.80, type: "normal" },
    352:{ name: "Erdinger Wei√übier 0,5 l", preis: 4.50, type: "normal" },
    353:{ name: "Erdinger Alkoholfrei 0,33 l", preis: 2.80, type: "normal" },
    354:{ name: "Erdinger Alkoholfrei 0,5 l", preis: 4.50, type: "normal" },

    400:{ name: "Rotwein trocken 0,2 l", preis: 4.90, type: "normal" },
    401:{ name: "Wei√üwein trocken 0,2 l", preis: 4.90, type: "normal" },
    402:{ name: "Glas Sekt", preis: 3.90, type: "normal" },
    403:{ name: "Campari Sekt", preis: 3.90, type: "normal" },
    410:{ name: "Aperitif Rosato", preis: 5.90, type: "normal" },
    430:{ name: "Grappa", preis: 4.70, type: "normal" },
    431:{ name: "Asbach", preis: 3.20, type: "normal" },
    432:{ name: "Ramazzotti", preis: 3.20, type: "normal" },
    433:{ name: "Aperol", preis: 6.10, type: "normal" },
    434:{ name: "Hugo", preis: 6.10, type: "normal" },

    500:{ name: "Flammkuchen Els√§sser Art", preis: 8.90, type: "normal" },
    501:{ name: "Flammkuchen Wildlachs & Shrimps", preis: 8.90, type: "normal" },
    502:{ name: "Flammkuchen Griechische Art", preis: 8.90, type: "normal" },
    510:{ name: "Toast mit K√§se", preis: 3.70, type: "normal" },
    511:{ name: "Toast mit K√§se & Schinken", preis: 4.30, type: "normal" },
    512:{ name: "Toast mit Salami & K√§se", preis: 4.30, type: "normal" },
    513:{ name: "Toast Hawaii", preis: 5.60, type: "normal" },
    520:{ name: "Baguette XXL", preis: 6.90, type: "normal" },

    600:{ name: "Apfelstrudel", preis: 3.70, type: "normal" },
    601:{ name: "Apfelstrudel mit Vanilleso√üe", preis: 4.00, type: "normal" },
    602:{ name: "Apfelstrudel mit Sahne", preis: 4.70, type: "normal" },
    603:{ name: "Apfelstrudel mit Eis", preis: 6.10, type: "normal" },
    610:{ name: "Hausgemachtes Tiramisu", preis: 4.20, type: "normal" },
    620:{ name: "Waffel mit Puderzucker", preis: 4.00, type: "normal" },
    621:{ name: "Waffel mit Sahne", preis: 5.00, type: "normal" },
    622:{ name: "Waffel mit Eis", preis: 5.30, type: "normal" },
    623:{ name: "Waffel mit Eis & Sahne", preis: 6.30, type: "normal" },
    624:{ name: "Waffel mit Nutella", preis: 5.00, type: "normal" },

    631:{ name: "630a. Waffel Zimt & Banane", preis: 6.80, type: "normal" },
    632:{ name: "630b. Waffel Obstsalat", preis: 7.90, type: "normal" },
    633:{ name: "630c. Waffel Erdbeeren", preis: 7.50, type: "normal" },
    634:{ name: "630d. Waffel Waldbeeren", preis: 7.20, type: "normal" },
    635:{ name: "630e. Waffel Schoko-Banane", preis: 7.90, type: "normal" },
    636:{ name: "630f. Waffel Hei√üe Kirschen", preis: 7.00, type: "normal" },
    637:{ name: "630g. Waffel Schoko", preis: 6.80, type: "normal" },
    638:{ name: "630h. Waffel Tutti Frutti", preis: 7.50, type: "normal" }
};

// Sortenliste (optional f√ºr Portionen)
const SORTEN = [
    "Vanille","Amarena","Joghurt","Nuss","Schokolade","Stracciatella",
    "After Eight","Schlumpfeis","Malaga","Walnuss","Cookies","Zitrone",
    "Erdbeere","Mango","Banane","Himbeere","Limette",
    "Dunkle Schokolade","Paw Patrol","Snickers","Pistazien"
];

// Produkte mit optionaler Sahne-Auswahl
const SAHNE_PRODUKTE = new Set([
    23, 24, 25, 26,
    30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,
    81,82,83,84,85,
    90,91,92,93,94,96,98,99,100,101,102,103,
    110,111,112,113,114,116,117,118,122,
    50,51,52,53,54,55,56,57,58,59,60,61,62,
    63,64,
    70,71,72,73,74,75,76,77,78,79,80,
    160,161,162,163,164,
    130,131,132,133,134,
    140,141,142,
    150,151,152,153,154,155,156,
    600,601,602,603,
    610,
    620,621,622,623,624,
    631,632,633,634,635,636,637,638
]);

/* GRUPPEN F√úR DIE 5 JANELAS */
const GROUPS = {
    portions: [23,24,25,26],
    kids: [23,160,161,162,163,164,130,154,150,151,152,153],
    eis: [
        30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,
        50,51,52,53,54,55,56,57,58,59,60,61,62,
        70,71,72,73,74,75,76,77,78,79,80,
        81,82,83,84,85,
        90,91,92,93,94,96,98,99,100,101,102,103,
        110,111,112,113,114,116,117,118,122
    ],
    food: [
        500,501,502,
        510,511,512,513,
        520,
        600,601,602,603,
        610,
        620,621,622,623,624,
        631,632,633,634,635,636,637,638
    ],
    drinks: [
        140,141,142,
        150,151,152,153,154,155,156,
        200,201,202,203,204,
        210,220,221,
        230,231,
        240,241,244,245,246,
        300,301,302,303,304,305,306,307,308,309,310,311,312,
        350,351,352,353,354,
        400,401,402,403,410,
        430,431,432,433,434
    ]
};

let warenkorb = [];
let currentGroup = "portions";

// Tische 1‚Äì33 f√ºllen
const tischSelect = document.getElementById("tisch");
for (let i = 1; i <= 33; i++) {
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = "Tisch " + i;
    tischSelect.appendChild(opt);
}

// Sorten-Selects f√ºllen
function fillSortenSelect(id) {
    const sel = document.getElementById(id);
    sel.innerHTML = "<option value=''>Sorte w√§hlen‚Ä¶</option>";
    SORTEN.forEach(s => {
        const opt = document.createElement("option");
        opt.value = s;
        opt.textContent = s;
        sel.appendChild(opt);
    });
}
["geschmack1", "geschmack2", "geschmack3"].forEach(fillSortenSelect);

// Produkt-Select f√ºr aktuelle Gruppe aufbauen
function buildProduktSelect(group) {
    const select = document.getElementById("produkt");
    select.innerHTML = "<option value=''>Bitte w√§hlen‚Ä¶</option>";
    const ids = GROUPS[group] || [];
    ids.forEach(id => {
        const p = PRODUKTE[id];
        if (!p) return;
        const opt = document.createElement("option");
        opt.value = id;
        opt.textContent =
            p.name + " ‚Äì " + p.preis.toFixed(2).replace(".", ",") + " ‚Ç¨";
        select.appendChild(opt);
    });

    // Boxen verstecken & Felder leeren
    document.getElementById("geschmack-box").style.display = "none";
    document.getElementById("sahne-box").style.display = "none";
    ["geschmack1","geschmack2","geschmack3"].forEach(id=>{
        document.getElementById(id).value = "";
    });
    document.getElementById("sahne").value = "";
    document.getElementById("bemerkung").value = "";
}

// Tabs aktivieren
document.querySelectorAll(".tab-btn").forEach(btn => {
    btn.addEventListener("click", () => {
        currentGroup = btn.dataset.group;
        document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        buildProduktSelect(currentGroup);
    });
});

// Beim Laden erste Gruppe f√ºllen
buildProduktSelect(currentGroup);

// Produktwechsel: Sorten-Box und Sahne-Box anzeigen/verstecken
document.getElementById("produkt").addEventListener("change", function() {
    const wert = this.value;
    const geschmackBox = document.getElementById("geschmack-box");
    const sahneBox = document.getElementById("sahne-box");

    if (!wert || !PRODUKTE[wert]) {
        geschmackBox.style.display = "none";
        sahneBox.style.display = "none";
        document.getElementById("sahne").value = "";
        return;
    }

    const idNum = parseInt(wert, 10);

    if (PRODUKTE[wert].type === "cup3") {
        geschmackBox.style.display = "block";
    } else {
        geschmackBox.style.display = "none";
        ["geschmack1", "geschmack2", "geschmack3"].forEach(id => {
            const sel = document.getElementById(id);
            if (sel) sel.value = "";
        });
    }

    if (SAHNE_PRODUKTE.has(idNum)) {
        sahneBox.style.display = "block";
    } else {
        sahneBox.style.display = "none";
        document.getElementById("sahne").value = "";
    }
});

function addToCart() {
    const tisch = document.getElementById("tisch").value;
    if (!tisch) {
        alert("Bitte zuerst den Tisch ausw√§hlen.");
        return;
    }

    const produktId = document.getElementById("produkt").value;
    if (!produktId || !PRODUKTE[produktId]) {
        alert("Bitte ein Produkt ausw√§hlen.");
        return;
    }

    const produkt = PRODUKTE[produktId];
    let sorten = [];
    const bemerkung = document.getElementById("bemerkung").value.trim();

    if (produkt.type === "cup3") {
        const s1 = document.getElementById("geschmack1").value;
        const s2 = document.getElementById("geschmack2").value;
        const s3 = document.getElementById("geschmack3").value;
        if (s1) sorten.push(s1);
        if (s2) sorten.push(s2);
        if (s3) sorten.push(s3);
    }

    let sahne = "";
    const idNum = parseInt(produktId, 10);
    if (SAHNE_PRODUKTE.has(idNum)) {
        sahne = document.getElementById("sahne").value;
    }

    warenkorb.push({
        id: produktId,
        name: produkt.name,
        preis: produkt.preis,
        type: produkt.type,
        sorten: sorten,
        bemerkung: bemerkung,
        sahne: sahne
    });

    document.getElementById("bemerkung").value = "";
    if (produkt.type === "cup3") {
        ["geschmack1", "geschmack2", "geschmack3"].forEach(id => {
            document.getElementById(id).value = "";
        });
    }
    document.getElementById("produkt").value = "";
    document.getElementById("sahne").value = "";

    updateCart();
}

function updateCart() {
    const liste = document.getElementById("liste-items");
    const totalDiv = document.getElementById("gesamt");
    const btnWpp = document.getElementById("btn-whatsapp");
    const btnPrint = document.getElementById("btn-print");

    liste.innerHTML = "";
    let total = 0;

    warenkorb.forEach((item, index) => {
        total += item.preis;

        const line = document.createElement("div");
        line.className = "line-item";

        const info = document.createElement("div");
        info.className = "item-info";

        let text = item.name + " ‚Äì " + item.preis.toFixed(2).replace(".", ",") + " ‚Ç¨";
        if (item.type === "cup3" && item.sorten.length > 0) {
            text += "<br><span class='small'>Sorten: " + item.sorten.join(", ") + "</span>";
        }
        if (item.bemerkung) {
            text += "<br><span class='small'>Bemerkung: " + item.bemerkung + "</span>";
        }
        if (item.sahne) {
            text += "<br><span class='small'>Sahne: " + item.sahne + "</span>";
        }
        info.innerHTML = text;

        const btnRemove = document.createElement("button");
        btnRemove.className = "btn-remove";
        btnRemove.textContent = "X";
        btnRemove.onclick = () => removeItem(index);

        line.appendChild(info);
        line.appendChild(btnRemove);
        liste.appendChild(line);
    });

    totalDiv.textContent = "Gesamt: " + total.toFixed(2).replace(".", ",") + " ‚Ç¨";
    const hasItems = warenkorb.length > 0;
    btnWpp.disabled = !hasItems || !gpsOk;
    btnPrint.disabled = !hasItems;
}

function removeItem(index) {
    warenkorb.splice(index, 1);
    updateCart();
}

function buildOrderText() {
    const tisch = document.getElementById("tisch").value || "-";
    let total = 0;
    let text = `Tisch ${tisch} - Bestellung:\n`;

    warenkorb.forEach(item => {
        total += item.preis;
        let line = `‚Ä¢ ${item.name} (${item.preis.toFixed(2)} ‚Ç¨)`;
        if (item.type === "cup3" && item.sorten.length > 0) {
            line += ` ‚Äì Sorten: ${item.sorten.join(", ")}`;
        }
        if (item.bemerkung) {
            line += ` ‚Äì Bemerkung: ${item.bemerkung}`;
        }
        if (item.sahne) {
            line += ` ‚Äì Sahne: ${item.sahne}`;
        }
        text += line + "\n";
    });

    text += `\nGesamtbetrag: ${total.toFixed(2)} ‚Ç¨`;
    return text;
}

function sendWhatsApp() {
    if (!gpsOk) {
        alert("Bestellung nur vor Ort m√∂glich. Bitte Standort-Freigabe erlauben.");
        return;
    }

    const tisch = document.getElementById("tisch").value;
    if (!tisch) {
        alert("Bitte zuerst den Tisch ausw√§hlen.");
        return;
    }
    if (warenkorb.length === 0) {
        alert("Der Warenkorb ist leer.");
        return;
    }

    const text = encodeURIComponent(buildOrderText());
    const url = `https://wa.me/${WHATSAPP_NUMMER}?text=${text}`;
    window.open(url, "_blank");

    warenkorb = [];
    updateCart();
}

function printOrder() {
    if (warenkorb.length === 0) {
        alert("Der Warenkorb ist leer.");
        return;
    }
    const tisch = document.getElementById("tisch").value || "-";
    const text = buildOrderText().replace(/\n/g, "<br>");

    const win = window.open("", "_blank");
    win.document.open();
    win.document.write(`
        <html>
        <head>
            <title>Bestellung Tisch ${tisch}</title>
            <meta charset="UTF-8">
        </head>
        <body style="font-family:Arial,sans-serif; font-size:14px;">
            <h2>Bestellung Tisch ${tisch}</h2>
            <p>${text}</p>
        </body>
        </html>
    `);
    win.document.close();
    win.print();
}

function resetTable() {
    if (!confirm("M√∂chten Sie den Tisch wirklich zur√ºcksetzen? Alle Bestellungen werden gel√∂scht.")) {
        return;
    }

    warenkorb = [];
    updateCart();

    const tischSel = document.getElementById("tisch");
    if (tischSel) tischSel.value = "";

    const produktSel = document.getElementById("produkt");
    if (produktSel) produktSel.value = "";

    ["geschmack1", "geschmack2", "geschmack3"].forEach(id => {
        const sel = document.getElementById(id);
        if (sel) sel.value = "";
    });

    const sahneSel = document.getElementById("sahne");
    if (sahneSel) sahneSel.value = "";

    document.getElementById("bemerkung").value = "";
}

/* ---------- GPS-FUNKTIONEN ---------- */

function deg2rad(deg) {
    return deg * (Math.PI / 180);
}

function distanceKm(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = deg2rad(lat2 - lat1);
    const dLon = deg2rad(lon2 - lon1);
    const a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
        Math.sin(dLon / 2) * Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
}

function initLocation() {
    const info = document.getElementById("gps-info");
    const btnWpp = document.getElementById("btn-whatsapp");

    if (!navigator.geolocation) {
        info.textContent = "GPS nicht verf√ºgbar ‚Äì Bestellung per WhatsApp ist deaktiviert.";
        gpsOk = false;
        btnWpp.disabled = true;
        return;
    }

    navigator.geolocation.getCurrentPosition(
        (pos) => {
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;
            const dist = distanceKm(lat, lng, CAFE_LAT, CAFE_LNG);

            if (dist <= MAX_DIST_KM) {
                gpsOk = true;
                info.textContent = "Standort OK ‚Äì Bestellung per WhatsApp ist m√∂glich.";
            } else {
                gpsOk = false;
                info.textContent = "Sie sind zu weit vom Standort entfernt ‚Äì Bestellung per WhatsApp nicht m√∂glich.";
            }
            updateCart();
        },
        (err) => {
            gpsOk = false;
            info.textContent = "Standort konnte nicht bestimmt werden ‚Äì bitte GPS erlauben.";
            btnWpp.disabled = true;
        }
    );
}

window.addEventListener("load", initLocation);
</script>

</body>
</html>
